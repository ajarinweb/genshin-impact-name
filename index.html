<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Nama Genshin Impact</title>

<style>
body {
    background: linear-gradient(135deg, #1e2a4a, #3a4f7a);
    font-family: Arial, sans-serif;
    height: 100vh;
    margin: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    color: white;
}

.box {
    background: rgba(0,0,0,0.55);
    padding: 25px;
    border-radius: 15px;
    width: 380px;
    text-align: center;
    box-shadow: 0 0 15px rgba(255,255,255,0.2);
}

button {
    margin: 8px;
    padding: 10px 18px;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    font-size: 14px;
}

.btn-primary {
    background: #4da3ff;
    color: white;
}

.btn-secondary {
    background: #ffd166;
    color: black;
}

select, input {
    width: 100%;
    padding: 8px;
    margin-top: 10px;
    border-radius: 8px;
    border: none;
}

.hidden { display: none; }

.search-box {
    position: relative;
}

.search-box span {
    position: absolute;
    right: 10px;
    top: 50%;
    transform: translateY(-50%);
    opacity: 0.7;
}

.table {
    margin-top: 15px;
    text-align: left;
    font-size: 13px;
}

.daerah {
    margin-top: 12px;
    font-weight: bold;
    border-bottom: 1px solid rgba(255,255,255,0.3);
}

.jenis {
    margin-top: 6px;
    font-weight: bold;
}

.nama {
    margin-left: 10px;
}
</style>
</head>

<body>

<!-- MENU AWAL -->
<div class="box" id="homeBox">
    <h2>Nama-nama di Genshin Impact</h2>
    <button class="btn-primary" onclick="showInput()">Masukan</button>
    <button class="btn-secondary" onclick="showCari()">Cari</button>
</div>

<!-- INPUT -->
<div class="box hidden" id="inputBox">
    <h2>Masukan Nama</h2>

    <select id="daerah" onchange="enableJenis()">
        <option value="">-- Pilih Daerah --</option>
        <option>Mondstad</option>
        <option>Liyue</option>
        <option>Inazuma</option>
        <option>Sumeru</option>
        <option>Fontain</option>
        <option>Natlan</option>
        <option>Nord-Krai</option>
        <option>Sneznaya</option>
    </select>

    <select id="jenis" disabled onchange="enableInput()">
        <option value="">-- Pilih Jenis --</option>
        <option>Laki-laki</option>
        <option>Perempuan</option>
        <option>Vanarana</option>
        <option>Oceanid</option>
        <option>Segwine</option>
        <option>Saurian</option>
        <option>Organisasi</option>
    </select>

    <input type="text" id="nama" placeholder="Masukan nama..." disabled>
    <button class="btn-primary" onclick="simpanData()">Simpan</button>
</div>

<!-- KONFIRMASI DUPLIKAT -->
<div class="box hidden" id="confirmBox">
    <h3>Nama sudah ada!</h3>
    <p>Perlu edit?</p>
    <button class="btn-primary" onclick="editData()">Edit</button>
    <button class="btn-secondary" onclick="buangData()">Buang</button>
</div>

<!-- CARI -->
<div class="box hidden" id="cariBox">
    <h3>Cari Nama</h3>

    <div class="search-box">
        <input type="text" id="searchInput" placeholder="Cari nama..." oninput="renderCari()">
        <span>üîç</span>
    </div>

    <div class="table" id="hasilCari"></div>

    <button class="btn-secondary" onclick="backToHome()">Kembali</button>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbxLKv8PnZw1G3u-iO8klQ-948TNuq-E1PMZwTbAhxqQbkntjwbDzifOP1q2grjTfsZv0Q/exec";
const daerahEl = document.getElementById("daerah");
const jenisEl = document.getElementById("jenis");
const namaEl = document.getElementById("nama");
let indexEdit = null;
let editMode = false;
let oldNama = "";

const jenisPerDaerah = {
    "Mondstad": ["Laki-laki","Perempuan","Organisasi"],
    "Liyue": ["Laki-laki","Perempuan","Organisasi"],
    "Inazuma": ["Laki-laki","Perempuan","Organisasi"],
    "Sumeru": ["Laki-laki","Perempuan","Vanarana","Organisasi"],
    "Fontain": ["Laki-laki","Perempuan","Oceanid","Segwine","Organisasi"],
    "Natlan": ["Laki-laki","Perempuan","Saurian","Organisasi"],
    "Nord-Krai": ["Laki-laki","Perempuan","Organisasi"],
    "Sneznaya": ["Laki-laki","Perempuan","Organisasi"]
};

/* NAV */
function showInput() {
    hideAll();
    document.getElementById("inputBox").classList.remove("hidden");
}

function showCari() {
    hideAll();
    cacheData = null; // reset cache
    document.getElementById("cariBox").classList.remove("hidden");
    renderCari();
}

function backToHome() {
    hideAll();
    document.getElementById("homeBox").classList.remove("hidden");
}

function hideAll() {
    ["homeBox","inputBox","confirmBox","cariBox"].forEach(id=>{
        document.getElementById(id).classList.add("hidden");
    });
}

function editData() {
    editMode = true;
    hideAll();
    document.getElementById("inputBox").classList.remove("hidden");
}

function buangData() {
    editMode = false;
    oldNama = "";
    resetForm();
    backToHome();
}

/* FORM */
function enableJenis() { jenisEl.disabled = false; }
function enableInput() { namaEl.disabled = false; }

function resetForm() {
    daerahEl.value="";
    jenisEl.value="";
    namaEl.value="";
    jenisEl.disabled=true;
    namaEl.disabled=true;
}

/* SIMPAN */
async function simpanData() {
    const daerah = daerahEl.value;
    const jenis = jenisEl.value;
    const nama = namaEl.value.trim();

    if (!daerah || !jenis || !nama) {
        alert("Semua data harus diisi!");
        return;
    }

    // ambil data dari cache / server
    if (!cacheData) {
        const res = await fetch(API_URL);
        cacheData = await res.json();
    }

    const found = cacheData.find(d =>
        d.nama.toLowerCase() === nama.toLowerCase()
    );

    if (found && !editMode) {
        oldNama = found.nama;

        // isi form untuk edit
        daerahEl.value = found.daerah;
        jenisEl.disabled = false;
        jenisEl.value = found.jenis;
        namaEl.disabled = false;
        namaEl.value = found.nama;

        hideAll();
        document.getElementById("confirmBox").classList.remove("hidden");
        return;
    }

    const payload = editMode
        ? { daerah, jenis, nama, mode: "edit", oldNama }
        : { daerah, jenis, nama };

    await fetch(API_URL, {
        method: "POST",
        body: JSON.stringify(payload)
    });

    alert(editMode ? "Data diperbarui!" : "Data disimpan!");

    editMode = false;
    oldNama = "";
    resetForm();
    backToHome();
}

/* CARI */
let cariTimeout = null;
let cacheData = null;

async function renderCari() {
    const q = document.getElementById("searchInput").value.toLowerCase();
    const hasil = document.getElementById("hasilCari");

    // debounce (hentikan render sebelumnya)
    clearTimeout(cariTimeout);

    cariTimeout = setTimeout(async () => {
        hasil.innerHTML = "";

        // ambil data sekali saja (cache)
        if (!cacheData) {
            const res = await fetch(API_URL);
            cacheData = await res.json();
        }

        Object.keys(jenisPerDaerah).forEach(daerah => {
            const dataDaerah = cacheData.filter(d =>
                d.daerah === daerah &&
                d.nama.toLowerCase().includes(q)
            );

            if (dataDaerah.length === 0) return;

            hasil.innerHTML += `<div class="daerah">| ${daerah} |</div>`;

            jenisPerDaerah[daerah].forEach(jenis => {
                const namaList = dataDaerah
                    .filter(d => d.jenis === jenis)
                    .map(d => d.nama)
                    .sort();

                if (namaList.length > 0) {
                    hasil.innerHTML += `<div class="jenis">${jenis}</div>`;
                    namaList.forEach(n => {
                        hasil.innerHTML += `<div class="nama">- ${n}</div>`;
                    });
                }
            });
        });

    }, 300); // render setelah user berhenti ngetik 300ms
}
</script>

</body>
</html>




